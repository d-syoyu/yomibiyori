# SNS共有機能要件（よみびより）

## 1. 機能概要

本機能は、アプリ内の各「下の句」を起点に、上の句・下の句および関連メタ情報をレイアウトした共有用カード画像を生成し、SNS など外部サービスへ共有できるようにするための機能である。

共有時には「画像」に加えて、「ホームページの URL（`https://yomibiyori.com`）を含むテキスト」を自動で挿入する。

- 対象画面
  - 鑑賞画面（他ユーザーの下の句一覧／詳細）
  - ランキング画面（日次ランキング一覧）
  - プロフィール画面（自分の下の句一覧）

- コンセプト
  - 画面全体のスクリーンショットではなく、アプリ側で用意した「共有カード用レイアウト」を画像化して共有する。
  - 各「下の句」カードに配置された小さなシェアアイコンから共有を開始する。
  - コメント機能は実装しない（いいね・シェアに限定したリアクション）。
  - X などの SNS へは「カード画像＋テキスト（作品紹介＋`https://yomibiyori.com`）」をセットで投稿できることを目指す。

---

## 2. 共通仕様

### 2.1 共有トリガー（シェアアイコン）

- 各「下の句」カードごとに、シェア用の小さなアイコンを表示する。
  - 推奨：外向き矢印、紙飛行機など「共有」を想起させるアイコン。
- 視覚的なアイコンサイズは小さめだが、タップ領域は 32〜40dp 程度を確保する。
- 配置位置（目安）
  - カード下部の右側、もしくはフッター右端。
  - 一覧スクロール時の誤タップを防ぐため、スクロール方向（縦）と干渉しづらい位置に設置。

### 2.2 共有フロー

1. ユーザーが「下の句」カード上のシェアアイコンをタップ。
2. 画面下部から半モーダル（シート）を表示する。
   - 上部：共有カードのプレビュー（実際にキャプチャ対象となる View）。
   - 下部：アクションボタン
     - 「画像として共有」
     - 「キャンセル」
3. 「画像として共有」ボタン押下時
   - 共有カード用 View を画像としてキャプチャ（PNG など）。
   - OS 標準の共有シートを表示し、「画像＋テキスト（2.4 参照）」を共有する。
   - X, Instagram, LINE, メールクライアント 等へ連携可能とする。

### 2.3 共有カード共通レイアウト仕様（画像）

共有カード（ShareCard）は画面に依存しない共通コンポーネント（もしくは共通デザインルール）として扱い、画面ごとの差分情報を Props 等で受け取る。

共通で必ず含める情報（画像内）：

- 上の句
  - 縦書き表示（アプリ内で利用する縦書きコンポーネントを流用）。
- 下の句
  - 縦書き表示。
- 作者名
  - 表記例：`@display_name`
  - 他人の作品では必須表示。
- 日付
  - 表記例：`2025-11-14`
- カテゴリ
  - 表記例：`季節`, `恋愛`, `日常`, `ユーモア` 等。
- 評価情報（任意）
  - いいね数（例：`♡ 23`）
  - ランキングやスコアが関係する画面の場合、その情報（詳細は各画面仕様にて）。
- アプリブランド情報
  - アプリ名：`よみびより`
  - ロゴ（簡易版でも可）
  - URL または QR コード
    - 表記例（画像内）：`yomibiyori.com`

レイアウト上の注意：

- SNS 側のトリミング（16:9 / 4:5 など）を考慮し、文字やロゴが端ギリギリに来ないよう十分な余白を確保する。
- 縦長になりすぎないよう、カード全体のアスペクト比は 4:5〜1:1 程度を想定。
-スタイルはアプリのスタイルに準拠。

### 2.4 共有テキストとリンク（投稿本文）

画像に加えて、共有時に自動で「投稿本文テキスト」をセットし、その中にホームページのリンクを含める。

#### 2.4.1 基本ルール

- すべての共有において、テキスト中に `https://yomibiyori.com` を必ず含める。
- 共有テキストは以下の要素で構成する：
  - 一言キャプション（固定文言＋画面別バリエーション）
  - 任意のハッシュタグ
  - ホームページ URL：`https://yomibiyori.com`

#### 2.4.2 テキスト例（X などを想定）

- 鑑賞画面からの共有例：
  ```text
  今日の一首を #よみびより で鑑賞しました。
  https://yomibiyori.com
  ```
- ランキング画面（1 位作品）の共有例：
  ```text
  今日のランキング1位の句です（季節部門）。
  #よみびより
  https://yomibiyori.com
  ```
- プロフィール画面（自分の作品）の共有例：
  ```text
  今日の一首を #よみびより で詠みました。
  https://yomibiyori.com
  ```

#### 2.4.3 技術的な前提

- OS 標準の共有シート呼び出し時に、「画像ファイル」と「テキスト」を同時に渡す。
  - iOS / Android の Share API の仕様に合わせて、`message` や `url` フィールドを組み合わせて利用する。
- 各 SNS ごとの挙動（テキストの初期値がどこまで維持されるか）はプラットフォーム依存であるため、
  - アプリ側では「デフォルトとして `https://yomibiyori.com` を含んだテキストを渡す」ことを保証し、
  - 実際の投稿時はユーザーが編集可能であることを前提とする。

---

## 3. 画面別仕様

### 3.1 鑑賞画面（他人の下の句一覧／詳細）

#### 3.1.1 カード構成

各「下の句」カードの構成（例）：

- 上部：
  - 上の句（縦書き）
  - 下の句（縦書き）
- 中央〜下部：
  - 作者名（`@display_name`）
  - カテゴリ
  - 日付
  - いいね数（例：`♡ 23`）
- 右下：
  - シェアアイコン（小さめ）

コメントアイコンやコメント数は表示しない（コメント機能非搭載）。

#### 3.1.2 シェア動作

- シェアアイコンタップ時
  - 対象の「上の句」「下の句」「作者名」「カテゴリ」「日付」「いいね数」を元に、鑑賞画面向けの共有カードを生成する。
  - 共有カード上には必ずアプリ名「よみびより」・ロゴを表示する。
  - 同時に、共有テキストとして以下のような文言を組み立てる：
    ```text
    今日の一首を #よみびより で鑑賞しました。
    https://yomibiyori.com
    ```
- その後のフローは「2.2 共有フロー」に準拠し、画像＋テキストを OS 共有シートへ渡す。

---

### 3.2 ランキング画面（日次ランキング一覧）

#### 3.2.1 行表示とシェアアイコン

ランキング画面では、日次ランキングの各行（各作品）にシェアアイコンを設置する。

- 行情報の例：
  - 順位（1位〜）
  - 上の句・下の句の冒頭やサマリ
  - 作者名
  - いいね数またはスコア
- シェアアイコンの配置：
  - 各行の右端に直接シェアアイコンを表示する。

#### 3.2.2 ランキング用共有カード仕様（画像）

ランキング画面からの共有では、「順位」に関する情報を共有カードに追加する。

- 追加要素：
  - 順位バッジ
    - 例：`本日の季節部門 1位`, `本日の恋愛部門 3位` など。
  - ランキング指標（任意）
    - 内部的には Wilson Score 等を利用していても、表示は分かりやすいスコアに変換。
    - 表記例：`共鳴スコア：83` など。

- カードデザイン例：
  - 上部に小さな「本日の◯◯部門 1位」バッジ。
  - 中央に上の句・下の句（縦書き）。
  - 下部に作者名・日付・カテゴリ・共鳴スコア。
  - 最下部にアプリ名「よみびより」・ロゴ・URL。

#### 3.2.3 シェア動作

- 各行のシェアアイコンタップ時
  - ランキング情報（順位・部門など）を含めた共有カードを生成する。
  - 同時に、共有テキストとして以下のような文言を組み立てる：
    ```text
    今日のランキング1位の句です（◯◯部門）。
    #よみびより
    https://yomibiyori.com
    ```
    - 部門名（カテゴリ）は、対象作品のカテゴリ情報から差し込む。
- その後のフローは「2.2 共有フロー」に準拠し、画像＋テキストを OS 共有シートへ渡す。

---

### 3.3 プロフィール画面（自分の下の句一覧）

#### 3.3.1 カード構成

自ユーザーの「下の句」一覧カードの構成（例）：

- 上部：
  - 上の句（縦書き）
  - 下の句（縦書き）
- 中央〜下部：
  - カテゴリ
  - 日付
  - いいね数（例：`♡ 10`）
- 右下：
  - シェアアイコン（小さめ）
- 必要であれば右上に編集アイコン（削除/修正用途）を配置。

#### 3.3.2 プロフィール用共有カード仕様（画像）

自分の作品を共有する場合は、「自作であること」を強調する演出が可能。

- 表示例：
  - 作者名：`@display_name` をやや大きめに表示。
  - キャプション的テキスト（画像内に入れる場合は小さく）
    - 例：`今日の一首`
- その他の要素（上の句・下の句・日付・カテゴリ・いいね数・アプリ名等）は共通仕様に準拠。

#### 3.3.3 シェア動作

- シェアアイコンタップ時
  - 対象作品の情報からプロフィール用共有カードを生成。
  - 同時に、共有テキストとして以下のような文言を組み立てる：
    ```text
    今日の一首を #よみびより で詠みました。
    https://yomibiyori.com
    ```
- その後のフローは「2.2 共有フロー」に準拠し、画像＋テキストを OS 共有シートへ渡す。

---

## 4. 非機能・ポリシー関連

### 4.1 プライバシー・著作権

- 利用規約にて、ユーザー作品がアプリ内および SNS 等外部サービスで共有され得ることを明記する。
- 共有カードには以下を含めない：
  - メールアドレス
  - 実名（ニックネームで運用する場合）
  - その他、本人の同意なしに第三者が望まない個人情報とみなされるもの

### 4.2 誤操作防止

- シェアアイコンはタップ領域を十分に確保し、スクロール操作との誤タップを軽減する。
- シェアアイコンタップ後、必ず半モーダルでプレビューと「キャンセル」を提供し、いきなり OS 共有シートへ遷移しない。

---

## 5. 技術的メモ（実装指針）

※ 実装時の参考用。要件上は具体的ライブラリには依存しないが、Expo / React Native 前提での想定。

- 共有カードは専用のコンポーネントとして実装する。
  - 例：`<WorkShareCard />`, `<RankingShareCard />`
- View → 画像化：
  - 対象 View を `ref` で参照し、必要に応じて画面外にレンダリングしてからキャプチャ。
  - 例：`captureRef` 相当の機能で PNG を生成。
- 共有：
  - OS 標準の共有シートを呼び出し、
    - 生成した画像ファイル
    - 共有テキスト（`https://yomibiyori.com` を含む）
    をセットで渡す。
- ロジック共通化：
  - `ShareButton` コンポーネントを用意し、各画面からは `workId` や `rankInfo` など必要情報のみ渡す。
  - 共有カード生成・キャプチャ・テキスト組み立て・共有処理は `ShareButton` 内で共通化する。

---
